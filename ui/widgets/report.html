<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <style>
        /* Load Aptos fonts from project fonts/ folder */
        @font-face {
            font-family: 'Aptos';
            src: url('../../fonts/Aptos.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: 'Aptos';
            src: url('../../fonts/Aptos-Bold.ttf') format('truetype');
            font-weight: 700;
            font-style: bold;
        }

        @font-face {
            font-family: 'Aptos';
            src: url('../../fonts/Aptos-Light.ttf') format('truetype');
            font-weight: 300;
            font-style: normal;
        }

        @page {
            size: A4;
            margin: 20mm 20mm 20mm 20mm;

            @top-right {
                content: element(header);
            }

            @bottom-center {
                content: element(footer);
            }
        }

        body {
            font-family: 'Aptos', serif;
            color: #000;
            line-height: 1.5;
            margin: 0;
            padding: 0;
            font-size: 11pt;
            text-align: justify;
        }

        /* Header & Footer */
        div.header {
            position: running(header);
            text-align: right;
            margin-bottom: 20px;
        }

        div.footer {
            position: running(footer);
            text-align: center;
            font-size: 9px;
            color: #000;
            width: 100%;
        }

        .logo {
            width: 120px;
            /* Adjusted size */
        }

        /* Cover Page */
        .cover {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 90vh;
            /* Adjust for header/footer */
            text-align: center;
        }

        .cover-image {
            width: 550px;
            margin: 0 auto 20px auto;
            display: block;
            border-radius: 8px;
        }

        .client-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .report-date {
            font-size: 14px;
            color: #333;
        }

        /* Typography */
        h1 {
            font-size: 18pt;
            color: darkblue;
            font-weight: bold;
            margin-top: 20px;
            margin-bottom: 10px;
            text-align: left;
            border: none;
            /* Remove previous border */
        }

        h2 {
            font-size: 16pt;
            color: rgb(233, 151, 0);
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 5px;
            text-align: left;
        }

        h3 {
            font-size: 12pt;
            color: #000;
            /* Normal text color but bold */
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 5px;
            text-align: left;
        }

        /* Special case for Modality Titles (Fixed/Mutable/Cardinal Energy) */
        .modality-title {
            font-size: 12pt;
            color: darkblue;
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 5px;
        }

        p {
            margin-bottom: 10px;
        }

        .blue-center {
            color: darkblue;
            text-align: center;
            font-weight: bold;
            margin: 15px 0;
        }

        .elemental-blueprint {
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }

        .elemental-blueprint span.label {
            color: darkblue;
        }

        .elemental-blueprint span.value {
            color: red;
        }

        /* Compact display for balanced elements: show only a small percentage bar */
        .element-balanced {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0 16px 0;
        }

        .element-balanced .element-perc {
            font-weight: 600;
            color: #333;
            width: 36px;
            text-align: right;
        }

        .perc-bar {
            flex: 1;
            height: 10px;
            background: #eee;
            border-radius: 6px;
            overflow: hidden;
        }

        .perc-fill {
            height: 100%;
            background: linear-gradient(90deg, #3EACA8, #3E8CA8);
            border-radius: 6px;
            width: 0%;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 11pt;
        }

        th,
        td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }

        th {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        .page-break {
            page-break-after: always;
        }

        .human-img {
            display: block;
            margin: 20px auto;
            max-width: 300px;
        }

        .subtle {
            color: #000;
            /* Reset subtle color to black for this design */
        }
    </style>
</head>

<body>

    <!-- Header (Logo) -->
    <div class="header">
        {% if logo_png %}
        <img src="data:image/png;base64,{{ logo_png }}" class="logo" alt="Logo" />
        {% endif %}
    </div>

    <!-- Footer (Disclaimer) -->
    <div class="footer">
        DISCLAIMER: The content of this document, such as text, graphics, images, and other material contained are for
        informational purposes only. This document is not intended to be a substitute for professional medical advice,
        diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any
        questions you may have regarding a health condition.
    </div>

    <!-- COVER PAGE -->
    <div class="cover">
        {% if cover_image_png %}
        <img src="data:image/png;base64,{{ cover_image_png }}" class="cover-image" alt="Cover Image" />
        {% endif %}

        <div class="client-name">{{ Personal.name if Personal is defined else (name or 'Client Name') }}</div>
        <div class="report-date">{{ report_date or "" }}</div>
    </div>

    <div class="page-break"></div>

    <!-- How Planetary Fields Entangle... -->
    <div>
        <h1>How Planetary Fields Entangle with Your Body's Energy Blueprint</h1>

        <p>Holistic well-being begins with a preventive approach to health, urging us not to wait until disease
            manifests. Your food choices play a pivotal role in shaping your body’s health, but it’s not just what you
            eat; your thoughts and emotional state significantly influence your well-being.</p>

        <p>Your body is interconnected to the environment surrounding you, from the obvious impacts of diet and
            lifestyle to even the more subtle influences like planetary gravitational pulls. We are most familiar with
            how the lunar cycle affects human behavior and physiology. The other planets in the solar system exert their
            influence in more subtle ways, affecting our energetic body.</p>

        <p>Our etheric body, our subtle energy counterpart of the physical body, possesses a series of force centers
            (nerves plexus) or chakras that receive the energy of the planets. According to Eastern teachings, the
            energy we receive from the Trinity passes from these subtle centers into our physical body by means of
            invisible circuits called nadis (Savitri, Hindu text) or meridians (TCM).</p>

        <p>All ailments are caused because our magnetic field doesn’t pull enough energy from the air we breathe into
            the lungs to supply the different parts of the body, so when weaker areas are not supplied with their
            energy, abnormal function results.</p>

        <p>Your astral chart reflects your own energy pattern to offer insights into your state of health, pinpoint
            nutritional deficiencies, and gauge your psychological balance.</p>

        <p>The condition and placement of planets in your chart can indicate potential health issues based on their
            dignity and avasthas, as well as the zodiac sign, they occupy. However, it's important to note that not all
            symptoms or diseases are certain to manifest, and their occurrence may vary throughout different stages of
            life corresponding to planetary periods (dasas/profections) and transits.</p>

        <p>When multiple planets highlight a particular ailment, the likelihood of its manifestation increases.</p>

        <p>Nonetheless, health astrology operates akin to a personalized weather forecast, offering insights for
            preventive measures rather than definitive predictions. Just as one prepares for possible rain by carrying
            an umbrella, understanding one's astrological health indicators facilitates proactive healthcare strategies
            aimed at prevention.</p>

        {% if human_png %}
        <img src="data:image/png;base64,{{ human_png }}" class="human-img" alt="Human Energy Field" />
        {% endif %}
    </div>

    <div class="page-break"></div>

    <!-- The Elements -->
    <div>
        <h1>The Elements</h1>

        <p>The four elements Fire Earth Water and Air can help you to pinpoint some obvious and easy ways to correct
            factors that affect health. Too much or not enough of an element can contribute to weakness in various parts
            of the body. By compensating for a lack of or an emphasis on an element one can alter the imbalance and
            improve health.</p>

        <p>Fire Earth Water and Air elements are the building-blocks of our physical as well as of our psychological
            functioning and we find them also in natural substances like herbs, and nutrition. This is the reason why
            understanding your health energetic blueprint makes healing possible.</p>

        <p>The Four Humors (Hippocrates, Galen) are the metabolic agents of the Four Elements in the human body. The
            right balance and purity of them is essential to maintaining health.</p>

        <div class="blue-center">An excess of a humor may lead to a great diversity of symptoms and diseases with the
            problem manifesting through the weakest point of the individual client.</div>

        <p>Every humor or element is a combination of two qualities: TEMPERATURE & MOISTURE. These concepts apply both
            physically and psychologically.</p>

        <table>
            <tr>
                <td><strong>FIRE</strong></td>
                <td><strong>HOT AND DRY</strong></td>
                <td>Heat: energy life impulse motive movement energy is spent and body cools down</td>
            </tr>
            <tr>
                <td><strong>AIR</strong></td>
                <td><strong>HOT AND MOIST</strong></td>
                <td>Coolness; malfunction, not enough energy for metabolic processes</td>
            </tr>
            <tr>
                <td><strong>EARTH</strong></td>
                <td><strong>COLD AND DRY</strong></td>
                <td>Dryness: maintains form and creates boundaries</td>
            </tr>
            <tr>
                <td><strong>WATER</strong></td>
                <td><strong>COLD AND MOIST</strong></td>
                <td>Moisture: cool conditions attract moisture, connects and softens</td>
            </tr>
        </table>

        <p>Because heat and cold are the primary characteristics, the placement on the scale of hot/cold is most
            important.</p>

        <p>An organism that is cold has to be heated and one that is too hot has to be cooled down. In practice we will
            use mainly foods of a humoral nature, contrary to the excess humor (the principle of antipathy). Also some
            foods can be eaten which have the temperature as the healing element but not the same degree of moisture/
            dryness.</p>

        <p>If the problem is excess water it is best to avoid all cold and moist foods and eat as much as you can from
            those foods listed under hot and dry. But some foods under hot and moist can be eaten too. These foods will
            heat the body up, and more heat always means less moisture. The secondary axis the moisture/dryness rate
            depends on the heat/cold axis to a certain extent.</p>

        <p>Lastly, herbs should work against the humoral excess that causes the disease; this is the most important
            thing. The exact herb that you need will be determined by the planetary positions in your chart. Also, they
            have to be taken at the right planetary hour for better results.</p>
    </div>

    <div class="page-break"></div>

    <!-- Your Elemental Blueprint -->
    <div>
        <h1>Your Elemental Blueprint</h1>

        {% set ep = Element_Percentages if (Element_Percentages is defined) else {} %}
        <div class="elemental-blueprint">
            <span class="label">Your element combination = </span>
            <span class="label">Fire</span> <span class="value">{{ ep.get('Fire', 0) }}%</span> –
            <span class="label">Earth</span> <span class="value">{{ ep.get('Earth', 0) }}%</span> –
            <span class="label">Air</span> <span class="value">{{ ep.get('Air', 0) }}%</span> –
            <span class="label">Water</span> <span class="value">{{ ep.get('Water', 0) }}%</span>
        </div>

        {# Prefer generator keys Element_Descriptions, fall back to mapped Elemental_Analysis #}
        {% set ea = Element_Descriptions if (Element_Descriptions is defined) else (Elemental_Analysis if
        (Elemental_Analysis is defined) else {}) %}

        {% for el_name in ['Fire', 'Air', 'Water', 'Earth'] %}
        {% set el_data = ea.get(el_name, {}) %}

        {# If element is Balanced we omit the full name/details but still print percentage compactly #}
        {% set percent = ep.get(el_name, 0) %}
        {% set status = el_data.get('Status', 'Balanced') %}
        {% if status != 'Balanced' %}
        <h2>The {{ el_name }} Element</h2>

        {# Extract content #}
        {# Logic to handle nested structure from fixed JSONs (e.g. {'air': {'low': {...}}}) #}
        {% set nested_content = el_data.get(el_name.lower()) %}
        {% set content_raw = '' %}

        {% if nested_content and (nested_content is mapping) %}
        {# Try to get content for the specific status (low/high) #}
        {% set content_raw = nested_content.get(status.lower()) or nested_content.get('balanced') or nested_content %}
        {% else %}
        {# Fallback to Content key or the object itself #}
        {% set content_raw = el_data.get('Content', el_data) if (el_data is mapping) else el_data %}
        {% endif %}

        {% set description = '' %}
        {% set scientific = '' %}
        {% set imbalance = '' %}
        {% set remedies = {} %}

        {% if content_raw is mapping %}
        {% set description = content_raw.get('The Fire Element') or content_raw.get('The Earth Element') or
        content_raw.get('The Air Element') or content_raw.get('The Water Element') or content_raw.get('Description') or
        '' %}
        {% set scientific = content_raw.get('Scientific Correlation') or '' %}

        {% set imbalance_title = '' %}
        {% set imbalance = '' %}

        {# Check for specific imbalance keys first #}
        {% if content_raw.get('What Low ' + el_name + ' Feels Like—and How It Holds You Back') %}
        {% set imbalance_title = 'What Low ' + el_name + ' Feels Like—and How It Holds You Back' %}
        {% set imbalance = content_raw.get('What Low ' + el_name + ' Feels Like—and How It Holds You Back') %}
        {% elif content_raw.get('What Low ' + el_name + ' Feels Like—and How It Scatters You') %}
        {% set imbalance_title = 'What Low ' + el_name + ' Feels Like—and How It Scatters You' %}
        {% set imbalance = content_raw.get('What Low ' + el_name + ' Feels Like—and How It Scatters You') %}
        {% elif content_raw.get('What Excess ' + el_name + ' Feels Like—and Why You Need to Rein It In') %}
        {% set imbalance_title = 'What Excess ' + el_name + ' Feels Like—and Why You Need to Rein It In' %}
        {% set imbalance = content_raw.get('What Excess ' + el_name + ' Feels Like—and Why You Need to Rein It In') %}
        {% elif content_raw.get('What Excess ' + el_name + ' Feels Like—and Why It\'s Time to Lighten Up') %}
        {% set imbalance_title = 'What Excess ' + el_name + ' Feels Like—and Why It\'s Time to Lighten Up' %}
        {% set imbalance = content_raw.get('What Excess ' + el_name + ' Feels Like—and Why It\'s Time to Lighten Up') %}
        {% elif content_raw.get('What Excess ' + el_name + ' Feels Like—and Why You Need to Dry Out') %}
        {% set imbalance_title = 'What Excess ' + el_name + ' Feels Like—and Why You Need to Dry Out' %}
        {% set imbalance = content_raw.get('What Excess ' + el_name + ' Feels Like—and Why You Need to Dry Out') %}
        {% elif content_raw.get('Low ' + el_name) %}
        {% set imbalance_title = 'Low ' + el_name %}
        {% set imbalance = content_raw.get('Low ' + el_name) %}
        {% elif content_raw.get('Excess ' + el_name) %}
        {% set imbalance_title = 'Excess ' + el_name %}
        {% set imbalance = content_raw.get('Excess ' + el_name) %}
        {% elif content_raw.get('Imbalance Effects') %}
        {% set imbalance_title = 'Imbalance Effects' %}
        {% set imbalance = content_raw.get('Imbalance Effects') %}
        {% endif %}

        {% set diet = content_raw.get('Diet') or '' %}
        {% set lifestyle = content_raw.get('Lifestyle and Exercise') or content_raw.get('Lifestyle and Exercise
        Recommendations') or '' %}
        {% set herbal = content_raw.get('Gems, Flower Remedies, and Aromas') or content_raw.get('Herbs') or
        content_raw.get('Crystals, Gems, and Herbal Remedies') or '' %}
        {% set remedies = {'Diet': diet, 'Lifestyle_and_Exercise': lifestyle, 'Herbal_or_Energy_Support': herbal} %}

        {# Extract the "Ways to Balance/Boost" or "Remedies to Balance" heading #}
        {% set balance_heading = '' %}
        {% set balance_desc = '' %}
        {% if content_raw.get('Ways to Boost Low ' + el_name) %}
        {% set balance_heading = 'Ways to Boost Low ' + el_name %}
        {% set balance_desc = content_raw.get('Ways to Boost Low ' + el_name) %}
        {% elif content_raw.get('Ways to Balance Excess ' + el_name) %}
        {% set balance_heading = 'Ways to Balance Excess ' + el_name %}
        {% set balance_desc = content_raw.get('Ways to Balance Excess ' + el_name) %}
        {% elif content_raw.get('Ways to Balance Low ' + el_name) %}
        {% set balance_heading = 'Ways to Balance Low ' + el_name %}
        {% set balance_desc = content_raw.get('Ways to Balance Low ' + el_name) %}
        {% elif content_raw.get('Remedies to Balance Low ' + el_name) %}
        {% set balance_heading = 'Remedies to Balance Low ' + el_name %}
        {% set balance_desc = content_raw.get('Remedies to Balance Low ' + el_name) %}
        {% elif content_raw.get('Remedies to Balance Excess ' + el_name) %}
        {% set balance_heading = 'Remedies to Balance Excess ' + el_name %}
        {% set balance_desc = content_raw.get('Remedies to Balance Excess ' + el_name) %}
        {% endif %}

        {% else %}
        {% set description = content_raw %}
        {% set scientific = el_data.get('Scientific_Correlation') %}
        {% set imbalance = el_data.get('Imbalance_Effects') %}
        {% set remedies = el_data.get('Remedies') or {} %}
        {% set balance_heading = '' %}
        {% set balance_desc = '' %}
        {% endif %}

        {% if description %}
        <p>{{ description | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}</p>
        {% endif %}

        {% if scientific %}
        <h3>Scientific Correlation</h3>
        <p>{{ scientific | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}</p>
        {% endif %}

        {% if imbalance %}
        <h3>{{ imbalance_title }}</h3>
        <p>{{ imbalance | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}</p>
        {% endif %}

        {% if balance_heading %}
        <h3>{{ balance_heading }}</h3>
        <p>{{ balance_desc | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}</p>
        {% endif %}

        {% if remedies and (remedies.Diet or remedies.Lifestyle_and_Exercise or remedies.Herbal_or_Energy_Support) %}
        <table>
            {% if remedies.Diet %}
            <tr>
                <td width="30%"><strong>Diet</strong></td>
                <td>{{ remedies.Diet | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}</td>
            </tr>
            {% endif %}
            {% if remedies.Lifestyle_and_Exercise %}
            <tr>
                <td><strong>Lifestyle & Exercise</strong></td>
                <td>{{ remedies.Lifestyle_and_Exercise | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}
                </td>
            </tr>
            {% endif %}
            {% if remedies.Herbal_or_Energy_Support %}
            <tr>
                <td><strong>Herbal / Energy Support</strong></td>
                <td>{{ remedies.Herbal_or_Energy_Support | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}
                </td>
            </tr>
            {% endif %}
        </table>
        {% endif %}

        {# Render all other keys from content_raw that haven't been handled yet #}
        {% if content_raw is mapping %}
        {% set rendered_keys = [
        'The Fire Element', 'The Earth Element', 'The Air Element', 'The Water Element',
        'Description', 'Scientific Correlation',
        'What Low ' + el_name + ' Feels Like—and How It Holds You Back',
        'What Low ' + el_name + ' Feels Like—and How It Scatters You',
        'What Low ' + el_name + ' Feels Like—and How It Dries You Out',
        'What Excess ' + el_name + ' Feels Like—and Why You Need to Rein It In',
        'What Excess ' + el_name + ' Feels Like—and Why It\'s Time to Lighten Up',
        'What Excess ' + el_name + ' Feels Like—and Why You Need to Ground It',
        'What Excess ' + el_name + ' Feels Like—and Why You Need to Dry Out',
        'Low ' + el_name, 'Excess ' + el_name,
        'Imbalance Effects',
        'Ways to Boost Low ' + el_name,
        'Ways to Balance Excess ' + el_name,
        'Ways to Balance Low ' + el_name,
        'Remedies to Balance Low ' + el_name,
        'Remedies to Balance Excess ' + el_name,
        'Diet', 'Lifestyle and Exercise', 'Lifestyle and Exercise Recommendations',
        'Gems, Flower Remedies, and Aromas', 'Herbs', 'Crystals, Gems, and Herbal Remedies',
        'Flower remedies'
        ] %}

        {% for key, value in content_raw.items() %}
        {% if key not in rendered_keys and value %}
        <h3>{{ key.replace('_', ' ') }}</h3>
        <p>{{ value | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}</p>
        {% endif %}
        {% endfor %}
        {% endif %}
        {% else %}
        {# Balanced element: show compact percentage only (no name/details) #}
        <div class="element-balanced">
            <div class="element-perc">{{ percent }}%</div>
        </div>
        {% endif %}
        {% endfor %}
    </div>

    <div class="page-break"></div>

    <!-- Your Daily Plan to Restore Balance -->
    <div>
        <h1>Your Daily Plan to Restore Balance</h1>
        {% set dg = Daily_Routine if (Daily_Routine is defined) else (Daily_Guideline if (Daily_Guideline is defined)
        else {}) %}

        {% for period, content in dg.items() %}
        {% if content and period not in ['__parse_error', '__error', 'raw', 'error_message'] %}
        <h2>{{ period|replace('_', ' ') }}</h2>
        {% if content is mapping %}
        <table>
            {% for ck, cv in content.items() %}
            <tr>
                <td width="30%"><strong>{{ ck.replace('_',' ') }}</strong></td>
                <td>{{ cv | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}</td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p>{{ content | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}</p>
        {% endif %}
        {% endif %}
        {% endfor %}
    </div>

    <div class="page-break"></div>

    <!-- The Qualities of your Elements -->
    <div>
        <h1>The Qualities of your Elements</h1>

        <p>The distribution on planets in the zodiacal wheel shows how we respond to stimuli, and especially how we act
            under tension. The presence of planets in a particular sign indicates how that sign expresses their element,
            meaning the mode of behavior they use to express the element needs. There are three qualities: Cardinal,
            Fixed, and Mutable.</p>
        <p>The quality of elements in your chart is</p>

        {% set mp = Modalities_Percentages if (Modalities_Percentages is defined) else {} %}
        <div class="elemental-blueprint">
            <span class="label">Cardinal</span> <span class="value">{{ mp.get('Cardinal', 0) }}%</span> –
            <span class="label">Fixed</span> <span class="value">{{ mp.get('Fixed', 0) }}%</span> –
            <span class="label">Mutable</span> <span class="value">{{ mp.get('Mutable', 0) }}%</span>
        </div>

        {% set mods = Modality_Descriptions if (Modality_Descriptions is defined) else (Modalities if (Modalities is
        defined) else {}) %}

        {% for mname, mcontent in mods.items() %}
        {# mcontent is typically {"Cardinal_Energy": {...}} #}
        {% set inner_dict = mcontent.get(mname + '_Energy') or mcontent %}

        {# Try to find the title key which is usually "Cardinal Energy", "Fixed Energy" etc #}
        {% set title_key = mname + ' Energy' %}
        {% set title_text = inner_dict.get(title_key) %}

        {% if title_text %}
        <div class="modality-title">{{ title_key }}</div>
        <p>{{ title_text | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}</p>
        {% else %}
        <div class="modality-title">{{ mname }} Energy</div>
        {% endif %}

        {% if inner_dict is mapping %}
        {% for k,v in inner_dict.items() %}
        {% if k != title_key %}
        <p><strong>{{ k.replace('_',' ') }}:</strong> {{ v | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe
            }}</p>
        {% endif %}
        {% endfor %}
        {% else %}
        <p>{{ inner_dict | replace('\n\n', '<br><br>') | replace('\n', '<br>') | safe }}</p>
        {% endif %}
        {% endfor %}
    </div>

    <div style="margin-top: 50px; text-align: center; font-weight: bold; font-size: 14px;">
        END OF THE ELEMENTS REPORT
    </div>

</body>

</html>